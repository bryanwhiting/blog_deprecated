

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.24.1">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>Webscraping Thousands of Used Cars</title>
    <meta name="author" content="Bryan Whiting">
    <meta name="keywords" content="">

    <link rel="icon" href="https://www.bryanwhiting.com/favicon.png">
    

    
    <meta name="description" content="In another post, I describe how I use this data that I’ve scraped, but I wanted to provide a more in-depth tutorial for those interested in how I got the data. Note, this data belongs to Truecar, so all uses herein are for personal and academic reasons only.
Get the data In order to do any good analaysis, you first need data. I prefer to have more data than less, where possible.">
    <meta property="og:description" content="In another post, I describe how I use this data that I’ve scraped, but I wanted to provide a more in-depth tutorial for those interested in how I got the data. Note, this data belongs to Truecar, so all uses herein are for personal and academic reasons only.
Get the data In order to do any good analaysis, you first need data. I prefer to have more data than less, where possible.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Webscraping Thousands of Used Cars">
    <meta property="og:url" content="/2017/10/getting-used-car-data/">
    <meta property="og:site_name" content="My take on data">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="My take on data">
    <meta name="twitter:description" content="In another post, I describe how I use this data that I’ve scraped, but I wanted to provide a more in-depth tutorial for those interested in how I got the data. Note, this data belongs to Truecar, so all uses herein are for personal and academic reasons only.
Get the data In order to do any good analaysis, you first need data. I prefer to have more data than less, where possible.">
    
      <meta name="twitter:creator" content="@bryanwhiting">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/0082821b175de32596e4c5cbb525f846?s=640">
    

    
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="https://www.bryanwhiting.com/css/style-u6mk0ojoywresbx8iepslrmmhl4stuhrsxuwhkpwrkrx7mryjcaimasnk4pi.min.css" />
    
    

    
      
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-85616639-1', 'auto');
ga('send', 'pageview');
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.bryanwhiting.com/">My take on data</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://www.bryanwhiting.com/#about">
    
    
    
      
        <img class="header-picture" src="//www.gravatar.com/avatar/0082821b175de32596e4c5cbb525f846?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.bryanwhiting.com/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/0082821b175de32596e4c5cbb525f846?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Bryan Whiting</h4>
        
          <h5 class="sidebar-profile-bio">Hacker, innovator, data scientist, father</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.bryanwhiting.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.bryanwhiting.com/about/index.html">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.bryanwhiting.com/projects/index.html">
    
      <i class="sidebar-button-icon fa fa-lg fa-briefcase"></i>
      
      <span class="sidebar-button-desc">Projects</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.bryanwhiting.com/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.bryanwhiting.com/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.bryanwhiting.com/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/2138773/bryan" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/bryanwhiting" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/bryan-whiting-b524a44b/" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
      
      <span class="sidebar-button-desc">LinkedIn</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.bryanwhiting.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Webscraping Thousands of Used Cars
    </h1>
  
  <div class="postShorten-meta post-meta">
  
    <time itemprop="datePublished" datetime="2017-10-18T00:00:00Z">
      
  October 18, 2017

    </time>
  
  
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.bryanwhiting.com/categories/tutorials">tutorials</a>
    
  


</div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <script src="https://www.bryanwhiting.com/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="https://www.bryanwhiting.com/rmarkdown-libs/jquery/jquery.min.js"></script>
<script src="https://www.bryanwhiting.com/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="https://www.bryanwhiting.com/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="https://www.bryanwhiting.com/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="https://www.bryanwhiting.com/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>


<p>In another post, I describe how I use this data that I’ve scraped, but I wanted to provide a more in-depth tutorial for those interested in how I got the data. Note, this data belongs to Truecar, so all uses herein are for personal and academic reasons only.</p>
<div id="get-the-data" class="section level1">
<h1>Get the data</h1>
<p>In order to do any good analaysis, you first need data. I prefer to have more data than less, where possible. In this case, I don’t have any data, so I use webscraping to get the data. There are much better tutorials on how to scrape data, so I’ll be light. I use R’s <code>rvest</code> package here, which does a decent job.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> Let’s look at Truecar’s Used Car postings<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>. First I use <code>google</code> to find the search query on Truecar that I like.</p>
<pre class="r"><code># Load packages
library(rvest)
library(dplyr)
library(magrittr)</code></pre>
<pre class="r"><code># Find the URL of the data you want to scrape
url &lt;- &#39;https://www.truecar.com/used-cars-for-sale/listings/ford/edge/location-90210/year-2015-max/?trimSlug=sel-awd&#39;
read_html(url)</code></pre>
<pre><code>## {xml_document}
## &lt;html lang=&quot;en-US&quot; data-qa=&quot;Index&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset= ...
## [2] &lt;body&gt;&lt;div&gt;\n&lt;div&gt;&lt;div id=&quot;main&quot;&gt;&lt;div&gt;&lt;div data-qa=&quot;TransitionHooks&quot; ...</code></pre>
<p>You’ll see there’s a head and a body. Our data’s in the body, so let’s use <code>html_nodes()</code> and <code>html_text()</code> to parse out the data we want. I used <a href="https://cran.r-project.org/web/packages/rvest/vignettes/selectorgadget.html">Selectorgadget</a> to know what HTML classes to search for.</p>
<pre class="r"><code>read_html(url) %&gt;% html_nodes(&#39;.col-xs-6.col-sm-8.no-left-padding&#39;) %&gt;% html_text()</code></pre>
<pre><code>##  [1] &quot;2015 Ford EdgeSEMileage: 45,702 milesLocation: Santa Ana, CAExterior: Ingot Silver MetallicInterior: BlackVIN: 2FMTK3G84FBB96919$14,899View Details&quot;                                                                  
##  [2] &quot;2015 Ford EdgeSEMileage: 31,750 milesLocation: Los Angeles, CAExterior: SilverInterior: BlackVIN: 2FMTK3G96FBB52901 Rating: Great Price$17,980$6,458 below marketView Details&quot;                                        
##  [3] &quot;2015 Ford EdgeSEMileage: 62,844 milesLocation: Pacoima, CAExterior: BlackVIN: 2FMTK4G87FBB97410$15,482View Details&quot;                                                                                                   
##  [4] &quot;2015 Ford EdgeSEMileage: 36,399 milesLocation: Huntington Beach, CAExterior: Tuxedo BlackInterior: EbonyVIN: 2FMTK3G97FBB92565$17,890View Details&quot;                                                                    
##  [5] &quot;2015 Ford EdgeSEMileage: 35,874 milesLocation: Huntington Beach, CAExterior: Tuxedo Black MetallicInterior: EbonyVIN: 2FMTK3G98FBC34774$18,990View Details&quot;                                                           
##  [6] &quot;2015 Ford EdgeSELMileage: 21,829 milesLocation: Los Angeles, CAExterior: GrayInterior: BlackVIN: 2FMTK3J95FBB01835 Rating: Great Price$20,480$7,063 below marketView Details&quot;                                         
##  [7] &quot;2015 Ford EdgeSEMileage: 62,747 milesLocation: Montclair, CAExterior: GrayInterior: TanVIN: 2FMTK3G98FBB43553Discount Available  Rating: Great Price$15,400$8,373 below marketView Details&quot;                           
##  [8] &quot;2015 Ford EdgeSEMileage: 7,526 milesLocation: Glendale, CAExterior: WhiteInterior: DuneVIN: 2FMTK3G95FBC20895$22,500View Details&quot;                                                                                     
##  [9] &quot;2015 Ford EdgeSEMileage: 22,098 milesLocation: Downey, CAExterior: WhiteInterior: BlackVIN: 2FMTK4G88FBC08043$20,400View Details&quot;                                                                                     
## [10] &quot;2015 Ford EdgeSEMileage: 30,332 milesLocation: Downey, CAExterior: WhiteInterior: BlackVIN: 2FMTK4G92FBB40573$19,900View Details&quot;                                                                                     
## [11] &quot;2015 Ford EdgeSELMileage: 33,841 milesLocation: Downey, CAExterior: BlackInterior: BlackVIN: 2FMTK3J86FBB20045 Rating: Great Price$21,500$4,454 below marketView Details&quot;                                             
## [12] &quot;2015 Ford EdgeSELMileage: 5,470 milesLocation: Glendora, CAExterior: Guard MetallicInterior: EbonyVIN: 2FMTK3J98FBC40065$23,965View Details&quot;                                                                          
## [13] &quot;2015 Ford EdgeTitaniumMileage: 30,703 milesLocation: Montebello, CAExterior: Tuxedo Black MetallicInterior: BlackVIN: 2FMPK3K8XFBB06293$22,499View Details&quot;                                                           
## [14] &quot;2015 Ford EdgeSELMileage: 41,010 milesLocation: GARDEN GROVE, CAExterior: GrayInterior: EbonyVIN: 2FMTK3J94FBB47723$22,495View Details&quot;                                                                               
## [15] &quot;2015 Ford EdgeSELMileage: 77,865 milesLocation: Rancho Santa Margarita, CAExterior: Tuxedo Black MetallicInterior: DuneVIN: 2FMTK3J94FBB47740$18,700View Details&quot;                                                     
## [16] &quot;2015 Ford EdgeSELMileage: 18,208 milesLocation: Carson, CAExterior: Ingot Silver MetallicInterior: EbonyVIN: 2FMTK4J82FBC05227Discount Available $24,997View Details&quot;                                                 
## [17] &quot;2015 Ford EdgeSELMileage: 30,942 milesLocation: Huntington Beach, CAExterior: Ingot SilverInterior: EbonyVIN: 2FMTK3J98FBB45599$23,490View Details&quot;                                                                   
## [18] &quot;2015 Ford EdgeSELMileage: 38,035 milesLocation: Downey, CAExterior: WhiteInterior: BeigeVIN: 2FMTK4J93FBB59643$22,100View Details&quot;                                                                                    
## [19] &quot;2015 Ford EdgeSELMileage: 38,633 milesLocation: Downey, CAExterior: BlackInterior: BlackVIN: 2FMTK4J9XFBC10183$22,200View Details&quot;                                                                                    
## [20] &quot;2015 Ford EdgeSELMileage: 27,169 milesLocation: Alhambra, CAExterior: BlackInterior: EbonyVIN: 2FMTK3J94FBB45521$24,991View Details&quot;                                                                                  
## [21] &quot;2015 Ford EdgeSELMileage: 24,922 milesLocation: Long Beach, CAExterior: BlackInterior: EbonyVIN: 2FMTK3J8XFBB55896Discount Available $24,378View Details&quot;                                                             
## [22] &quot;2015 Ford EdgeTitaniumMileage: 19,284 milesLocation: Huntington Beach, CAExterior: Tuxedo Black MetallicInterior: EbonyVIN: 2FMPK3K87FBB67701$25,590View Details&quot;                                                     
## [23] &quot;2015 Ford EdgeTitaniumMileage: 36,482 milesLocation: Downey, CAExterior: SilverInterior: BlackVIN: 2FMTK3K9XFBB06656 Rating: Great Price$23,400$6,371 below marketView Details&quot;                                       
## [24] &quot;2015 Ford EdgeSELMileage: 29,704 milesLocation: Huntington Beach, CAExterior: Tuxedo BlackInterior: EbonyVIN: 2FMTK3J99FBB47748$24,890View Details&quot;                                                                   
## [25] &quot;2015 Ford EdgeSELMileage: 19,405 milesLocation: Long Beach, CAExterior: BlackInterior: EbonyVIN: 2FMTK3J80FBB34135Discount Available $25,133View Details&quot;                                                             
## [26] &quot;2015 Ford EdgeSELMileage: 66 milesLocation: Los Angeles, CAExterior: Ruby Red MetallicInterior: EbonyVIN: 2FMTK4J80FBC39960Discount Available $27,995View Details&quot;                                                    
## [27] &quot;2015 Ford EdgeTitaniumMileage: 33,017 milesLocation: Downey, CAExterior: RedInterior: BlackVIN: 2FMTK3K91FBB43725$23,900View Details&quot;                                                                                 
## [28] &quot;2015 Ford EdgeSELMileage: 31,286 milesLocation: Los Angeles, CAExterior: RedInterior: EbonyVIN: 2FMPK4J98FBC39957Discount Available $25,498View Details&quot;                                                              
## [29] &quot;2015 Ford EdgeSELMileage: 46,451 milesLocation: Cerritos, CAExterior: WhiteInterior: TanVIN: 2FMTK4J90FBB34408$23,448View Details&quot;                                                                                    
## [30] &quot;2015 Ford EdgeTitaniumMileage: 25,899 milesLocation: Woodland Hills, CAExterior: GrayVIN: 2FMTK3K92FBB21314Discount Available $27,000View Details&quot;                                                                    
## [31] &quot;2015 Ford EdgeSELMileage: 16,995 milesLocation: Long Beach, CAExterior: BlackInterior: EbonyVIN: 2FMTK3J80FBB34071Discount Available $25,721View Details&quot;                                                             
## [32] &quot;2015 Ford EdgeSELMileage: 36,406 milesLocation: Long Beach, CAExterior: BlackInterior: EbonyVIN: 2FMTK4J80FBB48669Discount Available  Rating: Great Price$24,389$4,717 below marketView Details&quot;                      
## [33] &quot;2015 Ford EdgeSELMileage: 30,080 milesLocation: Huntington Beach, CAExterior: Ingot SilverInterior: EbonyVIN: 2FMTK3J84FBB45512 Rating: Great Price$25,890$2,066 below marketView Details&quot;                            
## [34] &quot;2015 Ford EdgeSELMileage: 56,147 milesLocation: Fontana, CAExterior: BlackInterior: EbonyVIN: 2FMPK3J89FBB27881$20,995View Details&quot;                                                                                   
## [35] &quot;2015 Ford EdgeTitaniumMileage: 42,797 milesLocation: Downey, CAExterior: Dk. GrayInterior: BlackVIN: 2FMTK3K91FBB22535$24,200View Details&quot;                                                                            
## [36] &quot;2015 Ford EdgeTitaniumMileage: 37,313 milesLocation: Downey, CAExterior: Off WhiteInterior: BlackVIN: 2FMTK3K82FBB56197$25,200View Details&quot;                                                                           
## [37] &quot;2015 Ford EdgeTitaniumMileage: 44,860 milesLocation: San Juan Capistrano, CAExterior: White Platinum Metallic Tri-CoatInterior: EbonyVIN: 2FMTK3K92FBB43801 Rating: Great Price$22,895$7,327 below marketView Details&quot;
## [38] &quot;2015 Ford EdgeSELMileage: 40,057 milesLocation: Upland, CAExterior: BlackInterior: BlackVIN: 2FMTK3J85FBB34115$24,880View Details&quot;                                                                                    
## [39] &quot;2015 Ford EdgeTitaniumMileage: 24,267 milesLocation: Downey, CAExterior: BlackInterior: BlackVIN: 2FMTK3K86FBB66389$26,600View Details&quot;                                                                               
## [40] &quot;2015 Ford EdgeSportMileage: 15,515 milesLocation: Long Beach, CAExterior: Tuxedo Black MetallicInterior: EbonyVIN: 2FMTK3AP8FBB73837Discount Available $28,967View Details&quot;                                           
## [41] &quot;2015 Ford EdgeSELMileage: 35,269 milesLocation: Chino, CAExterior: Ingot Silver MetallicInterior: EbonyVIN: 2FMTK3J98FBB67750$25,775View Details&quot;                                                                     
## [42] &quot;2015 Ford EdgeSportMileage: 53,110 milesLocation: Garden Grove, CAExterior: ChromeInterior: AluminumVIN: 2FMTK3AP9FBB09242Discount Available $23,995View Details&quot;                                                     
## [43] &quot;2015 Ford EdgeTitaniumMileage: 47,589 milesLocation: Downey, CAExterior: RedInterior: BeigeVIN: 2FMTK4K91FBB56691 Rating: Great Price$25,100$6,937 below marketView Details&quot;                                          
## [44] &quot;2015 Ford EdgeTitaniumMileage: 48,183 milesLocation: Long Beach, CAExterior: Tuxedo Black MetallicInterior: EbonyVIN: 2FMTK4K90FBB61994Discount Available  Rating: Great Price$25,354$6,439 below marketView Details&quot; 
## [45] &quot;2015 Ford EdgeSELMileage: 43,937 milesLocation: Riverside, CAExterior: Ruby Red Metallic Tinted ClearcoatInterior: DuneVIN: 2FMTK3J82FBB55861$24,985View Details&quot;</code></pre>
<p>So that’s how you get the data on a single page. If you look closer at the URL, you see a lot of helpful things. First, there’s the make, then the model, then the location-zip, then the year-range, and ultimately the trim. This is a very pretty and clean URL. If you click on a few additional pages, you’ll see the URL opens up with <code>?page=2</code>.</p>
<pre><code>https://www.truecar.com/used-cars-for-sale/listings/ford/edge/location-90210/?page=2</code></pre>
<p>This is our ‘in’ to scraping multiple pages. I won’t bore you with the details of how to get <em>that</em> data into a neat matrix for us to analyze, but suffice it to say that I’m able to do it. Just build a function to construct a URL, and build a loop to go through the different pages, then use lots of <code>str_extract</code> from the <code>stringr</code> package and <code>gsub</code> to clean up the data.</p>
<pre class="r"><code>library(stringr)

make = &#39;ford&#39;
model = &#39;edge&#39;
zip = &#39;90210&#39;
year = 2012
npages = 5

url &lt;- paste(&#39;https://www.truecar.com/used-cars-for-sale/listings/&#39;, 
             make, &#39;/&#39;, 
             model ,
             &#39;/location-&#39;, zip,
             &#39;/year-&#39;,year,&#39;-max/?page=&#39;, sep = &quot;&quot;)

urls &lt;- paste(url, 1:npages, sep = &quot;&quot;)

scrape &lt;- function(pageno){
  try(
    read_html(urls[pageno]) %&gt;% html_nodes(&#39;.col-xs-6.col-sm-8.no-left-padding&#39;) %&gt;% html_text()
  )
}

long_list = scrape(1)
for(i in 2:npages){
  print(i)
  new_list = try(scrape(i))
  
  error = (&quot;try-error&quot; %in% class(new_list))
  
  if( error == FALSE ){
    long_list = c(long_list, new_list) 
  } else {
    break
  }
}</code></pre>
<pre><code>## [1] 2
## [1] 3
## [1] 4
## [1] 5</code></pre>
<pre class="r"><code>stats &lt;- long_list
df &lt;- as.data.frame(stats)
df$stats %&lt;&gt;% as.character()
df$price &lt;- str_extract(df$stats, &#39;\\$[0-9]*,[0-9]*&#39;) %&gt;% 
  gsub(&#39;Price: |\\$|,&#39;, &#39;&#39;, .) %&gt;%
  as.numeric()
df$year &lt;- str_extract(df$stats, &#39;^[0-9]* &#39;) %&gt;% 
  as.numeric()
df$mileage &lt;- str_extract(df$stats, &#39;Mileage: [0-9]*,[0-9]*&#39;) %&gt;% 
  gsub(&#39;Mileage: |,&#39;, &#39;&#39;, .) %&gt;%
  as.numeric()

# a = df$stats[1]
df$trim &lt;- str_extract(df$stats, &#39;.*Mileage:&#39;) %&gt;% 
  gsub(&#39;FWD|AWD|4x[24]|[24]WD|V6|4-cyl|^[0-9][0-9][0-9][0-9]|4dr|Automatic|Manual|Mileage:&#39;, &#39;&#39;, ., ignore.case = T) %&gt;% 
  gsub(make, &#39;&#39;, ., ignore.case = T) %&gt;% 
  gsub(model, &#39;&#39;, ., ignore.case = T) %&gt;% 
  trimws() 


df$awd &lt;- grepl(&#39;AWD|4WD|4x4&#39;, df$stats, ignore.case = T) %&gt;% as.numeric()
df$manual &lt;- grepl(&#39;manual&#39;, df$stats) %&gt;% as.numeric()
df$v6 &lt;- grepl(&#39;V6&#39;, df$stats) %&gt;% as.numeric()
df$location &lt;- str_extract(df$stats, &#39;Location: .*Exterior:&#39;) %&gt;% 
  gsub(&#39;Location: |Exterior:&#39;, &#39;&#39;, .) %&gt;% 
  trimws() 
df$ext &lt;- str_extract(df$stats, &#39;Exterior: .*Interior:&#39;) %&gt;% 
  gsub(&#39;Interior:|Exterior:&#39;, &#39;&#39;, .) %&gt;% 
  trimws() 
df$int &lt;- str_extract(df$stats, &#39;Interior: .*VIN:&#39;) %&gt;% 
  gsub(&#39;Interior: |VIN:&#39;, &#39;&#39;, .) %&gt;% 
  trimws() 
df$vin &lt;- str_extract(df$stats, &#39;VIN: .*\\$&#39;) %&gt;% 
  gsub(&#39;VIN: |\\$&#39;, &#39;&#39;, .) %&gt;% 
  substr(., 1, 17)
df$deal &lt;- str_extract(df$stats, &#39;\\$[0-9]*,[0-9]* below&#39;) %&gt;% 
  gsub(&#39;below|\\$|,&#39;, &#39;&#39;, .) %&gt;% trimws() %&gt;%
  as.numeric()</code></pre>
<p>And here’s what the results look like. You’ve got the original scraped data in the <code>stats</code> column and then everything else that you can parse out. Just like that, you’ve got</p>
<pre class="r"><code># df was the dataframe object we needed
head(df) %&gt;% DT::datatable()</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["1","2","3","4","5","6"],["2012 Ford EdgeSELMileage: 87,179 milesLocation: Long Beach, CAExterior: Ingot Silver MetallicInterior: Charcoal BlackVIN: 2FMDK3JCXCBA82243Discount Available $12,967View Details","2012 Ford EdgeLimitedMileage: 83,415 milesLocation: Thousand Oaks, CAExterior: WhiteInterior: TanVIN: 2FMDK3KC6CBA95361Discount Available $13,333View Details","2012 Ford EdgeSELMileage: 41,470 milesLocation: Woodland Hills, CAExterior: CinnamonVIN: 2FMDK3J94CBA49744$18,000View Details","2012 Ford EdgeLimitedMileage: 77,883 milesLocation: Mission Hills, CAExterior: SilverVIN: 2FMDK3KC2CBA41460Discount Available $14,992View Details","2012 Ford EdgeLimitedMileage: 83,603 milesLocation: Irvine, CAExterior: Ingot Silver MetallicInterior: Charcoal BlackVIN: 2FMDK3K96CBA46150$13,980View Details","2012 Ford EdgeSportMileage: 58,297 milesLocation: Buena Park, CAExterior: Tuxedo Black MetallicInterior: Charcoal BlackVIN: 2FMDK3AK7CBA93272$17,980View Details"],[12967,13333,18000,14992,13980,17980],[2012,2012,2012,2012,2012,2012],[87179,83415,41470,77883,83603,58297],["SEL","Limited","SEL","Limited","Limited","Sport"],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],["Long Beach, CA","Thousand Oaks, CA","Woodland Hills, CA","Mission Hills, CA","Irvine, CA","Buena Park, CA"],["Ingot Silver Metallic","White",null,null,"Ingot Silver Metallic","Tuxedo Black Metallic"],["Charcoal Black","Tan",null,null,"Charcoal Black","Charcoal Black"],["2FMDK3JCXCBA82243","2FMDK3KC6CBA95361","2FMDK3J94CBA49744","2FMDK3KC2CBA41460","2FMDK3K96CBA46150","2FMDK3AK7CBA93272"],[null,null,null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>stats<\/th>\n      <th>price<\/th>\n      <th>year<\/th>\n      <th>mileage<\/th>\n      <th>trim<\/th>\n      <th>awd<\/th>\n      <th>manual<\/th>\n      <th>v6<\/th>\n      <th>location<\/th>\n      <th>ext<\/th>\n      <th>int<\/th>\n      <th>vin<\/th>\n      <th>deal<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,6,7,8,13]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Python’s <code>beautifulSoup</code> package could probably do a better job.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>I tried scraping CarGurus, but wasn’t able to paginate. I tried scraping CarMax, but had difficulty. Edmunds was also easy, but Truecar was easiset.<a href="#fnref2">↩</a></p></li>
</ol>
</div>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.bryanwhiting.com//tags/r/">r</a>

  <a class="tag tag--primary tag--small" href="https://www.bryanwhiting.com//tags/webscraping/">webscraping</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://www.bryanwhiting.com/2018/02/buying-a-used-car-the-data-science-way/" data-tooltip="Buying a used car the data science way (and hacking Truecar)">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://www.bryanwhiting.com/2017/06/yet-another-weekly-planner/" data-tooltip="Yet Another Weekly Planner">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2fwww.bryanwhiting.com%2f2017%2f10%2fgetting-used-car-data%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.bryanwhiting.com%2f2017%2f10%2fgetting-used-car-data%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fwww.bryanwhiting.com%2f2017%2f10%2fgetting-used-car-data%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Bryan Whiting. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://www.bryanwhiting.com/2018/02/buying-a-used-car-the-data-science-way/" data-tooltip="Buying a used car the data science way (and hacking Truecar)">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://www.bryanwhiting.com/2017/06/yet-another-weekly-planner/" data-tooltip="Yet Another Weekly Planner">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2fwww.bryanwhiting.com%2f2017%2f10%2fgetting-used-car-data%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.bryanwhiting.com%2f2017%2f10%2fgetting-used-car-data%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fwww.bryanwhiting.com%2f2017%2f10%2fgetting-used-car-data%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2fwww.bryanwhiting.com%2f2017%2f10%2fgetting-used-car-data%2f">
        <i class="fa fa-google-plus"></i><span>Share on Google Plus</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.bryanwhiting.com%2f2017%2f10%2fgetting-used-car-data%2f">
        <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fwww.bryanwhiting.com%2f2017%2f10%2fgetting-used-car-data%2f">
        <i class="fa fa-twitter"></i><span>Share on Twitter</span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/0082821b175de32596e4c5cbb525f846?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Bryan Whiting</h4>
    
      <div id="about-card-bio">Hacker, innovator, data scientist, father</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Data Scientist
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Washington, D.C.
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.bryanwhiting.com/2018/02/buying-a-used-car-the-data-science-way/">
                <h3 class="media-heading">Buying a used car the data science way (and hacking Truecar)</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">So you want to buy a car, but you don’t know anything about them? Welcome to my life.
You show up at the dealer and there’s a sticker on the window. You know the difference between make and model, but you soon learn what a trim is. Some versions come with leather. Some have a sun roof. Some have all wheel drive. Some have 20k in miles, and a similarly priced car in a higher trim is at 40k miles.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.bryanwhiting.com/2017/10/getting-used-car-data/">
                <h3 class="media-heading">Webscraping Thousands of Used Cars</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Oct 10, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">In another post, I describe how I use this data that I’ve scraped, but I wanted to provide a more in-depth tutorial for those interested in how I got the data. Note, this data belongs to Truecar, so all uses herein are for personal and academic reasons only.
Get the data In order to do any good analaysis, you first need data. I prefer to have more data than less, where possible.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.bryanwhiting.com/2017/06/yet-another-weekly-planner/">
                <h3 class="media-heading">Yet Another Weekly Planner</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">I believe that each creation has four phases: dreaming, planning, acting, and reflecting. Think about it - is there anything you&rsquo;ve ever made that didn&rsquo;t first enter into your mind, you came up with some game plan, you carried it out, and then when you were done you could see what went well and where you improved? Isn&rsquo;t this what scrums are really about?
I wanted a scrum for my personal life, but I didn&rsquo;t find it practical to use the many online resources available.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.bryanwhiting.com/2017/06/blogdown-and-tranquilpeak-hosted-on-netlify-a-deep-dive/">
                <h3 class="media-heading">Blogdown and Tranquilpeak Hosted on Netlify: a Deep Dive</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">This blog will outline what I see as differences between Hugo and Jekyll, some benefits and drawbacks of using Netlify vs. GitHub pages to host, and how to launch the Hugo Tranquilpeak theme from scratch.
Why Hugo? One of my first posts was about blogging with Jekyll hosted on GitHub. About six months after writing that post, I hit a few bugs trying to debug it and got frustrated because I had already forgotten all of what I binge-learned earlier.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.bryanwhiting.com/2017/02/the-dataviz-battle-plotly-vs-ggplot2/">
                <h3 class="media-heading">The DataViz battle: Plotly vs ggplot2</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">R users fall in love with ggplot2, the growing standard for data visualization in R. The ability to quickly vizualize trends, and customize just about anything you’d want, make it a powerful tool. Yet this week, I made a discvoery that may reduce how much I used ggplot2. Enter plot_ly().
For this post, I assume that you have a working knowledge of the dplyr (or magrittr) and ggplot2 packages.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.bryanwhiting.com/2017/01/the-shell-and-its-many-languages/">
                <h3 class="media-heading">The Shell and its Many Languages</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">If you don&rsquo;t know how to use the shell/terminal/command line, you should. Why? Here&rsquo;s a sampling of I&rsquo;ve done in the last month:
 I used R to generate 30,000 plots using ggplot(). I used the shell and ffmpeg to animate those plots as a movie. I&rsquo;ve used the shell from VBA to send an Excel column of data into Stata, execute a summary statistic command, and then import the results back into Excel.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.bryanwhiting.com/2016/11/starting-with-jekyll/">
                <h3 class="media-heading">Starting with Jekyll</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Hello world.
I wanted to start a blog. I wanted to set it up for free, use a custom URL (and not something.bloggingplatform.com), and be able to both blog and create tutorials. I didn&rsquo;t mind it possibly being technical1. Enter Jekyll.
If you want to get your blog in 10 minutes, skip to below.
Why Blog with Jekyll? Here&rsquo;s why you can and should blog with Jekyll (if you&rsquo;re a data scientist):</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://www.bryanwhiting.com/post/">
                <h3 class="media-heading">Posts</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         8 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://www.bryanwhiting.com/images/durango-blurred.JPG');"></div>
  


    
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.js"></script>


<script src="https://www.bryanwhiting.com/js/script-wl33z0n6ocaypepiqrazthtivfrliqijej4rq8ek8gvrv1awftmgjuv8k4zc.min.js"></script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight').each(function(i, block) {
    var code = "";
    hljs.highlightAuto(block.innerText).value.split(/\r\n|\r|\n/).forEach(function(line) {
      code += "<span class=\"line\">" + line + "</span><br>";
    });
    if (code.length > 0) {
      block.innerHTML = code;  
    }
  });
  $('pre > code').each(function(i, block) {
    $(this).addClass('codeblock');
    hljs.highlightBlock(block);
  });
});
</script>

  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/www.bryanwhiting.com\/2017\/10\/getting-used-car-data\/';
          
            this.page.identifier = '\/2017\/10\/getting-used-car-data\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'bryanwhiting1';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  





    
  </body>
</html>

